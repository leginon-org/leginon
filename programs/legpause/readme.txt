INSTALLATION

***Installation of lpclient.pl on Windows***

Install Norhof monitor pump software according to Norhof's documentation.
Install the community edition of Active Perl or some other version of Perl.
(The script has been tested with Active Perl only.)  Install the
Win32::GuiTest Perl module.  Place lpclient.pl in the directory of your
choice and add the directory to PATH (or alternatively execute
lpclient.pl by navigating to the correct directory).

***Installation of the remaining scripts on the Linux system with Leginon running***

Install the Perl module X11::GUITest.  The Perl module IO::Socket is also
required but may be standard on most systems.

Untar the gzipped tar file the directory of your choice.

cd <my-dir>
tar xzf legpause_v2.tgz

Edit your .cshrc file to add the directory with the scripts to PATH
and the directory with the Perl modules to PERL5LIB:
setenv PATH ${PATH}:<my-dir>/legpause_v2_dist/legpause_v2/scripts
setenv PERL5LIB ${PERL5LIB}:<my-dir>/legpause_v2_dist/legpause_v2

(Or do the equivalent changes in .bashrc or however you prefer to
control your user environment in Linux.)


USING THE SCRIPTS

***Creating configuration file***

The first stage, if it has not been done already on the given choice
of Linux system, resolution settings and Linux desktop, is to
run legpause_config.pl.  (GUI elements may also change position
depending on the version of Leginon and the specific MSI app that is used.)
Leginon will have to be running in the MSI app you wish to use, before
starting legpause_config.pl:

legpause_config.pl <new-legpause-config-file>

legpause_config.pl prompts for information required and walks through
clicking on the different GUI elements (buttons, etc) in the Leginon
GUI.

***Actually using the Leginon pause server***

Again Leginon should already be running before starting the Leginon
pause server.  You will usually want Leginon to have already be
set up with an automated run in one of the MSI apps before starting
the Leginon pause server.  Because the the Leginon pause server
simulates user clicks, it will not generally be a good idea to have
it running when you think you will be working manually on the desktop
(although this is not a problem for short periods when an automated
click is unlikely to be generated by the Leginon pause server).
The server is started with:

lpserver.pl <my-config-file>

where <my-config-file> is a suitable configuration file generated
by following the instructions above for legpause_config.pl.  Generally
it will be a good idea to re-direct standard error and standard output
from lpserver.pl to a log file and run lpserver.pl in the background:

lpserver.pl <my-config-file> >& lpserver.log &

(Currently lpserver.pl is hard-coded to listen on port 60000 although
it may be advisable to use a different port.)
Then the Leginon pause client is started on the Windows system that
is interfaced to the Norhof pump:

lpclient.pl <server-host> <prefill-time-mins> <postfill-time-mins>
<stop-time-mins>

<server-host> will be the hostname of the system with Leginon and
the Leginon pause server running.  <prefill-time-mins> is the time
before liquid nitrogen top up that a pause request will be made.
(Depending on the state of Leginon - e.g. current obtaining an
exposure or in the drift manager - Leginon may not respond to a
pause request immediately; so it is advisable to leave some additional
time before sending a Leginon pause request.  Generally a few minutes
is sufficient.)  <postfill-time-mins> is the time after
liquid nitrogen top up has completed that an unpause request will
be made.  <stop-time-mins> is the time that Leginon will be stopped.
It may be preferable to usually quit Leginon and 
lpclient.pl manually and also kill lpserver.pl manually.  In this
case an arbitrarily large <stop-time-mins> can be used (corresponding
to a run time substantially larger than the few days of a typical run).


SUMMARY OF PROGRAMS:

legpause_v2:
lpclient.pl - current version of the "Leginon pause client" that requests
pauses and unpauses of Leginon, depending on what happens in
the Norhof pump monitor software.  lpclient.pl must be installed
on a Windows system together with the Norhof pump monitor program.
This version of the program was re-organized 
to use some of the shared code in Perl packages.
It does not actually add any new functionality and may be less
well tested than the previous version of the client.
WinSpy++ was useful in developing lpclient.pl for finding names of GUI
elements and may be useful for anybody continuing to maintain
lpclient.pl if the Norhof Monitor Software GUI changes in the future.
WinSpy++ is available from http://www.catch22.net/software/winspy-17 .

lpclient_orig.pl - the final version of the "Leginon pause client" before
re-organizing code into packages.  (This also must be installed on
Windows together with the Norhof monitor software, of course.)

lptestclient.pl - a simple "Leginon pause client" test program that
is run on Linux.  Pause or unpause requests are specified on the
command line.  It was written to test some of the changes made
in lpclient.pl without an available Norhof pump.

lpserver.pl - the "Leginon pause server".  It runs on the same Linux
system that Leginon is running on.  Pause and unpause requests
are sent to this server which pauses or unpauses Leginon by simulating
user interaction with the GUI via X11 Window.

legpause_config.pl - program to create a configuration file that
allows lpserver.pl to correctly find the GUI elements in Leginon
that it simulates mouse points and clicks on.  This appears to
be necessary on changing between different versions of Linux,
resolution settings in X11 or even different choices of desktop
(e.g. from Window Maker to KDE).

legpause.pl - test program to quickly check that all the required
GUI elements can be found in the Leginon GUI.  (It does this
by directly attempting to pause and unpause Leginon.)

legpause_v1:
lpclient.pl: as above.  This is identical to the v.2 lpclient_orig.pl.

legpause.pl: this is another test program that was used for
a crude configure.  The coordinates of buttons, etc were altered by
hand until they were found correctly as demonstrated by running
the program.  Then the corresponding changes in the code would
be made in the server.  There should not be any reason to use
this or the old version of the server any more.

lpserver.pl: old version of the "Leginon pause server".

REFERENCE

WV Nicholson, H White and J Trinick (2010) Journal of Structural Biology 172, 395-399.  "An approach to automated acquisition of cryoEM images from lacey carbon grids."
